7a3118d83f55e472b6bb6e59564b0f5d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const image_1 = require("../src/utils/image");
describe('ImageProcessing', () => {
    test('toBitmap converts white pixel to 0', () => {
        // RGBA: White (255, 255, 255, 255)
        const data = new Uint8Array([255, 255, 255, 255]);
        const width = 1;
        const height = 1;
        const bitmap = image_1.ImageProcessing.toBitmap(data, width, height);
        // Expect 0 (white)
        expect(bitmap[0]).toBe(0);
    });
    test('toBitmap converts black pixel to 1', () => {
        // RGBA: Black (0, 0, 0, 255)
        const data = new Uint8Array([0, 0, 0, 255]);
        const width = 1;
        const height = 1;
        const bitmap = image_1.ImageProcessing.toBitmap(data, width, height);
        // Expect 1 (black) - bit 7 set: 10000000 = 128
        expect(bitmap[0]).toBe(128);
    });
    test('toBitmap handles dithering (gray pixel)', () => {
        // RGBA: Gray (128, 128, 128, 255) - 2x1 image
        // Pixel 1: Gray -> Threshold 128. 128 >= 128 -> White (0). Error = 128 - 255 = -127?
        // Wait, logic: oldPixel = 128. newPixel = 128 < 128 ? 0 : 255 => 255 (White).
        // Error = 128 - 255 = -127.
        // Neighbor (Pixel 2) gets error * 7 / 16.
        const data = new Uint8Array([
            128, 128, 128, 255, // Pixel 1
            128, 128, 128, 255 // Pixel 2
        ]);
        const width = 2;
        const height = 1;
        const bitmap = image_1.ImageProcessing.toBitmap(data, width, height);
        // Byte 1 contains both pixels.
        // Pixel 1 (x=0): White (0). Bit 7 = 0.
        // Pixel 2 (x=1): Original 128 + (-127 * 7/16) = 128 - 55 = 73.
        // 73 < 128 -> Black (0). Wait, logic: newPixel = 73 < 128 ? 0 : 255 => 0 (Black).
        // So Pixel 2 should be Black. Bit 6 = 1.
        // Result byte: 01000000 = 64.
        expect(bitmap[0]).toBe(64);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3pma2MvRGVza3RvcC8wMy3np7vliqjnq6/pobnnm64vdGFyby1ibHVldG9vdGgtcHJpbnQvdGVzdHMvaW1hZ2UudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUNBLDhDQUFxRDtBQUVyRCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsbUNBQW1DO1FBQ25DLE1BQU0sSUFBSSxHQUFHLElBQUksVUFBVSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNsRCxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDaEIsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sTUFBTSxHQUFHLHVCQUFlLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFN0QsbUJBQW1CO1FBQ25CLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1FBQzlDLDZCQUE2QjtRQUM3QixNQUFNLElBQUksR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDNUMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNqQixNQUFNLE1BQU0sR0FBRyx1QkFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdELCtDQUErQztRQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtRQUNuRCw4Q0FBOEM7UUFDOUMscUZBQXFGO1FBQ3JGLDhFQUE4RTtRQUM5RSw0QkFBNEI7UUFDNUIsMENBQTBDO1FBRTFDLE1BQU0sSUFBSSxHQUFHLElBQUksVUFBVSxDQUFDO1lBQzFCLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxVQUFVO1lBQzlCLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBRSxVQUFVO1NBQy9CLENBQUMsQ0FBQztRQUNILE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNoQixNQUFNLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDakIsTUFBTSxNQUFNLEdBQUcsdUJBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU3RCwrQkFBK0I7UUFDL0IsdUNBQXVDO1FBQ3ZDLCtEQUErRDtRQUMvRCxrRkFBa0Y7UUFDbEYseUNBQXlDO1FBQ3pDLDhCQUE4QjtRQUU5QixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3pma2MvRGVza3RvcC8wMy3np7vliqjnq6/pobnnm64vdGFyby1ibHVldG9vdGgtcHJpbnQvdGVzdHMvaW1hZ2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IEltYWdlUHJvY2Vzc2luZyB9IGZyb20gJy4uL3NyYy91dGlscy9pbWFnZSc7XG5cbmRlc2NyaWJlKCdJbWFnZVByb2Nlc3NpbmcnLCAoKSA9PiB7XG4gIHRlc3QoJ3RvQml0bWFwIGNvbnZlcnRzIHdoaXRlIHBpeGVsIHRvIDAnLCAoKSA9PiB7XG4gICAgLy8gUkdCQTogV2hpdGUgKDI1NSwgMjU1LCAyNTUsIDI1NSlcbiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzI1NSwgMjU1LCAyNTUsIDI1NV0pO1xuICAgIGNvbnN0IHdpZHRoID0gMTtcbiAgICBjb25zdCBoZWlnaHQgPSAxO1xuICAgIGNvbnN0IGJpdG1hcCA9IEltYWdlUHJvY2Vzc2luZy50b0JpdG1hcChkYXRhLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIC8vIEV4cGVjdCAwICh3aGl0ZSlcbiAgICBleHBlY3QoYml0bWFwWzBdKS50b0JlKDApO1xuICB9KTtcblxuICB0ZXN0KCd0b0JpdG1hcCBjb252ZXJ0cyBibGFjayBwaXhlbCB0byAxJywgKCkgPT4ge1xuICAgIC8vIFJHQkE6IEJsYWNrICgwLCAwLCAwLCAyNTUpXG4gICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAyNTVdKTtcbiAgICBjb25zdCB3aWR0aCA9IDE7XG4gICAgY29uc3QgaGVpZ2h0ID0gMTtcbiAgICBjb25zdCBiaXRtYXAgPSBJbWFnZVByb2Nlc3NpbmcudG9CaXRtYXAoZGF0YSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvLyBFeHBlY3QgMSAoYmxhY2spIC0gYml0IDcgc2V0OiAxMDAwMDAwMCA9IDEyOFxuICAgIGV4cGVjdChiaXRtYXBbMF0pLnRvQmUoMTI4KTtcbiAgfSk7XG5cbiAgdGVzdCgndG9CaXRtYXAgaGFuZGxlcyBkaXRoZXJpbmcgKGdyYXkgcGl4ZWwpJywgKCkgPT4ge1xuICAgIC8vIFJHQkE6IEdyYXkgKDEyOCwgMTI4LCAxMjgsIDI1NSkgLSAyeDEgaW1hZ2VcbiAgICAvLyBQaXhlbCAxOiBHcmF5IC0+IFRocmVzaG9sZCAxMjguIDEyOCA+PSAxMjggLT4gV2hpdGUgKDApLiBFcnJvciA9IDEyOCAtIDI1NSA9IC0xMjc/XG4gICAgLy8gV2FpdCwgbG9naWM6IG9sZFBpeGVsID0gMTI4LiBuZXdQaXhlbCA9IDEyOCA8IDEyOCA/IDAgOiAyNTUgPT4gMjU1IChXaGl0ZSkuXG4gICAgLy8gRXJyb3IgPSAxMjggLSAyNTUgPSAtMTI3LlxuICAgIC8vIE5laWdoYm9yIChQaXhlbCAyKSBnZXRzIGVycm9yICogNyAvIDE2LlxuXG4gICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KFtcbiAgICAgIDEyOCwgMTI4LCAxMjgsIDI1NSwgLy8gUGl4ZWwgMVxuICAgICAgMTI4LCAxMjgsIDEyOCwgMjU1ICAvLyBQaXhlbCAyXG4gICAgXSk7XG4gICAgY29uc3Qgd2lkdGggPSAyO1xuICAgIGNvbnN0IGhlaWdodCA9IDE7XG4gICAgY29uc3QgYml0bWFwID0gSW1hZ2VQcm9jZXNzaW5nLnRvQml0bWFwKGRhdGEsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gQnl0ZSAxIGNvbnRhaW5zIGJvdGggcGl4ZWxzLlxuICAgIC8vIFBpeGVsIDEgKHg9MCk6IFdoaXRlICgwKS4gQml0IDcgPSAwLlxuICAgIC8vIFBpeGVsIDIgKHg9MSk6IE9yaWdpbmFsIDEyOCArICgtMTI3ICogNy8xNikgPSAxMjggLSA1NSA9IDczLlxuICAgIC8vIDczIDwgMTI4IC0+IEJsYWNrICgwKS4gV2FpdCwgbG9naWM6IG5ld1BpeGVsID0gNzMgPCAxMjggPyAwIDogMjU1ID0+IDAgKEJsYWNrKS5cbiAgICAvLyBTbyBQaXhlbCAyIHNob3VsZCBiZSBCbGFjay4gQml0IDYgPSAxLlxuICAgIC8vIFJlc3VsdCBieXRlOiAwMTAwMDAwMCA9IDY0LlxuXG4gICAgZXhwZWN0KGJpdG1hcFswXSkudG9CZSg2NCk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=